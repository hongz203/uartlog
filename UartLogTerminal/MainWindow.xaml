<Window x:Class="UartLogTerminal.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="UART Log Terminal"
        Height="900"
        Width="1480"
        MinHeight="700"
        MinWidth="1180">
    <Grid Margin="12">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0"
                Padding="10"
                BorderThickness="1"
                CornerRadius="6"
                BorderBrush="#FFCCCCCC">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock VerticalAlignment="Center" Text="COM Port" />
                <ComboBox Margin="8,0,0,0"
                          Width="130"
                          ItemsSource="{Binding AvailablePorts}"
                          SelectedItem="{Binding SelectedPort}" />

                <TextBlock Margin="14,0,0,0" VerticalAlignment="Center" Text="Baud" />
                <ComboBox Margin="8,0,0,0"
                          Width="120"
                          ItemsSource="{Binding BaudRates}"
                          SelectedItem="{Binding SelectedBaudRate}" />

                <Button Margin="14,0,0,0"
                        Padding="12,4"
                        Content="Refresh"
                        Command="{Binding RefreshPortsCommand}" />
                <Button Margin="8,0,0,0"
                        Padding="12,4"
                        Content="Connect"
                        Command="{Binding ConnectCommand}" />
                <Button Margin="8,0,0,0"
                        Padding="12,4"
                        Content="Disconnect"
                        Command="{Binding DisconnectCommand}" />

                <TextBlock Margin="16,0,0,0" VerticalAlignment="Center" Text="Status:" />
                <TextBlock Margin="6,0,0,0"
                           VerticalAlignment="Center"
                           FontWeight="SemiBold"
                           Foreground="{Binding StatusBrush}"
                           Text="{Binding ConnectionStatus}" />
            </StackPanel>
        </Border>

        <Border Grid.Row="1"
                Margin="0,10,0,0"
                Padding="10"
                BorderThickness="1"
                CornerRadius="6"
                BorderBrush="#FFCCCCCC">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock VerticalAlignment="Center" Text="TX" />
                <TextBox Margin="8,0,0,0"
                         Width="600"
                         Text="{Binding TxInput, UpdateSourceTrigger=PropertyChanged}">
                    <TextBox.InputBindings>
                        <KeyBinding Key="Enter" Command="{Binding SendCommand}" />
                    </TextBox.InputBindings>
                </TextBox>
                <Button Margin="10,0,0,0"
                        Padding="14,4"
                        Content="Send"
                        Command="{Binding SendCommand}" />
                <CheckBox Margin="16,0,0,0"
                          VerticalAlignment="Center"
                          Content="Paused"
                          IsChecked="{Binding IsPaused}" />
                <Button Margin="10,0,0,0"
                        Padding="12,4"
                        Content="Clear All"
                        Command="{Binding ClearCommand}" />
            </StackPanel>
        </Border>

        <Border Grid.Row="2"
                Margin="0,10,0,10"
                Padding="10"
                BorderThickness="1"
                CornerRadius="6"
                BorderBrush="#FFCCCCCC">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock VerticalAlignment="Center" Text="Filters" FontWeight="SemiBold" />
                <Button Margin="10,0,0,0"
                        Padding="12,4"
                        Content="Add Filter Tab"
                        Command="{Binding AddFilterTabCommand}" />
                <Button Margin="8,0,0,0"
                        Padding="12,4"
                        Content="Remove Selected Tab"
                        Command="{Binding RemoveSelectedFilterTabCommand}" />
                <TextBlock Margin="12,0,0,0"
                           VerticalAlignment="Center"
                           Foreground="#FF666666"
                           Text="Each tab has its own keyword/regex and foreground/background color." />
            </StackPanel>
        </Border>

        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.1*" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="1.4*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0"
                    BorderThickness="1"
                    CornerRadius="6"
                    BorderBrush="#FFCCCCCC">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <TextBlock Margin="10,8,10,8" FontWeight="SemiBold" Text="Raw Logs" />
                    <TextBox Grid.Row="1"
                             Margin="10,0,10,10"
                             FontFamily="Consolas"
                             FontSize="13"
                             IsReadOnly="True"
                             TextWrapping="NoWrap"
                             VerticalScrollBarVisibility="Auto"
                             HorizontalScrollBarVisibility="Auto"
                             Text="{Binding RawLogText, Mode=OneWay}" />
                </Grid>
            </Border>

            <Border Grid.Column="2"
                    BorderThickness="1"
                    CornerRadius="6"
                    BorderBrush="#FFCCCCCC">
                <TabControl Margin="10"
                            ItemsSource="{Binding FilterTabs}"
                            SelectedItem="{Binding SelectedFilterTab}">
                    <TabControl.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Name}" />
                        </DataTemplate>
                    </TabControl.ItemTemplate>
                    <TabControl.ContentTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="*" />
                                </Grid.RowDefinitions>
                                <Border Padding="8"
                                        BorderThickness="1"
                                        CornerRadius="6"
                                        BorderBrush="#FFDDDDDD">
                                    <WrapPanel VerticalAlignment="Center">
                                        <TextBlock VerticalAlignment="Center" Text="Tab Name" />
                                        <TextBox Margin="8,0,10,0"
                                                 Width="140"
                                                 Text="{Binding Name, UpdateSourceTrigger=PropertyChanged}" />
                                        <TextBlock VerticalAlignment="Center" Text="Keyword / Regex" />
                                        <TextBox Margin="8,0,10,0"
                                                 Width="240"
                                                 Text="{Binding Expression, UpdateSourceTrigger=PropertyChanged}" />
                                        <CheckBox Margin="2,0,10,0"
                                                  VerticalAlignment="Center"
                                                  Content="Regex"
                                                  IsChecked="{Binding UseRegex}" />
                                        <CheckBox Margin="2,0,10,0"
                                                  VerticalAlignment="Center"
                                                  Content="Match case"
                                                  IsChecked="{Binding MatchCase}" />
                                        <TextBlock VerticalAlignment="Center" Text="FG" />
                                        <ComboBox Margin="8,0,10,0"
                                                  Width="120"
                                                  ItemsSource="{Binding DataContext.ColorOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  DisplayMemberPath="Name"
                                                  SelectedItem="{Binding SelectedForegroundColor}" />
                                        <TextBlock VerticalAlignment="Center" Text="BG" />
                                        <ComboBox Margin="8,0,0,0"
                                                  Width="120"
                                                  ItemsSource="{Binding DataContext.ColorOptions, RelativeSource={RelativeSource AncestorType=Window}}"
                                                  DisplayMemberPath="Name"
                                                  SelectedItem="{Binding SelectedBackgroundColor}" />
                                    </WrapPanel>
                                </Border>

                                <ListBox Grid.Row="1"
                                         Margin="0,10,0,0"
                                         ItemsSource="{Binding Lines}">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate>
                                            <ItemsControl ItemsSource="{Binding Segments}">
                                                <ItemsControl.ItemsPanel>
                                                    <ItemsPanelTemplate>
                                                        <StackPanel Orientation="Horizontal" />
                                                    </ItemsPanelTemplate>
                                                </ItemsControl.ItemsPanel>
                                                <ItemsControl.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock FontFamily="Consolas"
                                                                   FontSize="13"
                                                                   Foreground="{Binding ForegroundBrush}"
                                                                   Background="{Binding BackgroundBrush}"
                                                                   Text="{Binding Text}" />
                                                    </DataTemplate>
                                                </ItemsControl.ItemTemplate>
                                            </ItemsControl>
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </DataTemplate>
                    </TabControl.ContentTemplate>
                </TabControl>
            </Border>
        </Grid>

        <TextBlock Grid.Row="4"
                   Margin="0,10,0,0"
                   Foreground="#FF666666"
                   Text="{Binding FooterText}" />
    </Grid>
</Window>
